# Window Functions (PostgreSQL Strength!)

- PostgreSQL has **long supported** these powerful analytics functions; MySQL added them only recently (v8+).

**PostgreSQL**:

```postgresql
SELECT
  name,
  score,
  RANK() OVER (PARTITION BY class ORDER BY score DESC) AS rank
FROM students;
```

**Example with dvdrental database**

```postgresql
SELECT
	CUSTOMER_ID,
	STORE_ID,
	SUM(AMOUNT) AS TOTAL,
	RANK() OVER (
		PARTITION BY
			STORE_ID
		ORDER BY
			SUM(AMOUNT) DESC
	) AS STORE_RANK
FROM
	PAYMENT
	JOIN CUSTOMER USING (CUSTOMER_ID)
GROUP BY
	CUSTOMER_ID,
	STORE_ID;
```

![Window_Func_Result](Imgs\Window_Func_Result.png)

**MySQL**

```mysql
SELECT
  name,
  score,
  RANK() OVER (PARTITION BY class ORDER BY score DESC) AS rank
FROM students;

```





---

## Common Table Expressions (CTEs)

- PostgreSQLâ€™s CTE support is older, better optimized, and works well even with recursion.

**PostgreSQL**

```postgresql
WITH top_customers AS (
	SELECT customer_id, SUM(amount) total
    FROM orders 
    GROUP BY customer_id
    ORDER BY total DESC 
    LIMIT 5
)
SELECT * FROM top_customers;
```

**Example in dvdrental database**

```postgresql
WITH
	TOP_CUSTOMERS AS (
		SELECT
			CUSTOMER_ID,
			SUM(AMOUNT) AS TOTAL_PAID
		FROM
			PAYMENT
		GROUP BY
			CUSTOMER_ID
		ORDER BY
			TOTAL_PAID DESC
		LIMIT
			5
	)
SELECT
	C.FIRST_NAME,
	C.LAST_NAME,
	T.TOTAL_PAID
FROM
	TOP_CUSTOMERS T
	JOIN CUSTOMER C ON C.CUSTOMER_ID = T.CUSTOMER_ID;
```

![CTE_Result](Imgs\CTE_Result.png)
