# THe setuid and setgid special permission bits

- A binary executable file with the owner execute bit set to `s` is called a **setuid binary**.
- If the owner of said executable file is root, then it's called a **setuid-root binary**.
- When we execute a setuid program, the key point is that the EUID is set to the owner of the binary executable file. Thus, with setuid-root binaries, the process will run as root!
- Once the process dies, we are back to our shell with our regular (default) set of process credentials or privileges.



Conceptually similar to setuid is the notion of the setgid special permission bit:

- A binary executable file with the group execute bit set to `s` is called a setgid binary.
- When we execute a setgid program, the key point is that the EGID is set to the group membership of the binary executable file.
- Once the process dies, we are back to our shell with our regular (default) set of process credentials or privileges.





- The `set [u | g] id` special permission bits only have significance on binary executable files, nothing else.
- Attempting to set these bits on a script (bash, Perl, and so on) will have absolutely no effect.



## Setting the setuid and setgid bits with `chmod`

- Setting the setuid and setgid bits on an executable tells the system to run that program with the privileges of the file’s owner or group, respectively, rather than the privileges of the user who launched it. 
- This is often used for programs that require elevated privileges to perform their tasks.

### How It Works

- **Setuid (Set User ID):**
  - When the setuid bit is set on an executable file, any user who runs that program temporarily gains the effective user ID of the file’s owner. 
  - A common example is the `passwd` command, which needs root privileges to modify the system password file.
- **Setgid (Set Group ID):**
  - Similarly, when the setgid bit is set on an executable, the process gains the effective group ID of the file’s group upon execution. 
  - For directories, setgid can also ensure that new files inherit the directory’s group.

### Using chmod to Set These Bits

We can set these bits with the `chmod` command in two common ways: using symbolic mode or numeric mode.

#### Symbolic Mode

- **Setuid Example**:

  ```bash
  chmod u+s myprogram
  ```

  - This command adds the setuid bit to `myprogram`.

- **Setgid Example**:

  ```bash
  chmod g+s myprogram
  ```

  - This command sets the setgid bit to `myprogram`.

- **Setting Both at Once:**

  ```bash
  chmod u+s,g+s myprogram
  ```

#### Numeric Mode

- In numeric (octal) mode, we can specify the special bits using additional digits:

- The special permission bits are added as the thousands digit:

  - **Setuid**: 4
  - **Setgid:**2
  - **Sticky Bit**: 1 (often used on directories)

- For example, if we want to set the setuid bit and also give the owner full permissions (7), and read/execute permissions for the group and others (5 each), we would use:

  ```bash
  chmod 4755 myprogram
  ```

- If we want to set both setuid and setgid, we add 4 (for setuid) and 2(for setgid) to get 6 as the thousands digit:

  ```bash
  chmod 6755 myprogram
  ```

```bash
# Set the setuid bit using symbolic mode:
chmod u+s exampleprog

# Or, using numeric mode (assuming permissions should be rwxr-xr-x):
chmod 4755 exampleprog
```

- Now when any user executes `exampleprog`, the process will run with the effective user ID of the file's owner, allowing it to perform privileged operations if necessary.



### Example

```shell
chan@CMA:~/C_Programming/test$ ls -l final
-rwxrwxr-x 1 chan chan 17848 Feb 11 20:41 final
chan@CMA:~/C_Programming/test$ chmod u+s final ; ls -l final
-rwsrwxr-x 1 chan chan 17848 Feb 11 20:41 final
chan@CMA:~/C_Programming/test$ chmod u-s,g+s final ; ls -l final
-rwxrwsr-x 1 chan chan 17848 Feb 11 20:41 final
chan@CMA:~/C_Programming/test$ chmod g-s final ; ls -l final
-rwxrwxr-x 1 chan chan 17848 Feb 11 20:41 final

```

