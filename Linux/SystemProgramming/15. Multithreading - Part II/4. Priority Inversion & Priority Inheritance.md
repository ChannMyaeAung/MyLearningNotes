# Priority Inversion

- A scenario in concurrent systems where a high-priority thread is forced to wait for a resource held by a lower-priority thread. 
- This situation becomes problematic when a medium-priority thread—one that does not need the shared resource—runs and preempts the lower-priority thread. 
- As a result, the high-priority thread is indirectly blocked by the medium-priority thread, even though it should be the most urgent.

---

### How It Happens

- **Resource Contention:**
   A low-priority thread holds a lock or resource needed by a high-priority thread.
- **Interference:**
   Before the low-priority thread can finish its work and release the resource, a medium-priority thread preempts it.
- **Inversion:**
   The high-priority thread ends up waiting longer than expected, effectively inverting the intended priority order.

---

## Mitigation Strategy: Priority Inheritance

- A common protocol used to address priority inversion. 
- When a higher-priority thread is blocked by a lower-priority thread holding a resource, the system temporarily boosts the priority of the lower-priority thread to that of the highest waiting thread. 
- This allows the lower-priority thread to complete its work and release the resource more quickly, reducing the waiting time for the high-priority thread.

### Example Scenario

- **Thread L (Low priority):** Holds a lock.
- **Thread H (High priority):** Needs the lock held by Thread L.
- **Thread M (Medium priority):** Does not require the lock and preempts Thread L.

Without priority inheritance, Thread H must wait for Thread L, which in turn is delayed by Thread M. 

With priority inheritance, Thread L temporarily runs at high priority, quickly releasing the lock so Thread H can proceed.

This mechanism ensures that high-priority tasks are less affected by the delays caused by lower-priority ones, maintaining the overall responsiveness of the system.

The pthreads API set provides a pair of APIs to query and set the protocol mutex attribute:

```c
int pthread_mutexattr_getprotocol(const pthread_mutexattr_t *restrict attr, int *restrict protocol);
int pthread_mutexattr_setprotocol(pthread_mutexattr_t *attr, int protocol);
```



---