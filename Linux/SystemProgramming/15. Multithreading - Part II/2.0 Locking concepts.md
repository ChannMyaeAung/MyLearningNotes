# Locking concepts

- To prevent races, we have to guarantee that the code of the critical section runs alone and atomically.
- To do so, we must synchronize critical sections.
  - **Critical Section:** Part of the code where the shared resource is accessed. Locks are acquired before entering the critical section and released afterward.
- Among several forms of synchronization, one of the commonly ones is **locking**.
- A lock is ultimately a data structure instantiated as a variable.
- **By definition:** Locking is a fundamental concept in concurrent programming used to protect shared resources from simultaneous access, which can lead to race conditions and inconsistent state. 
- By using locks, we ensure that only one thread (or process) can execute a critical section of code at a time.
- Only one thread can hold or own a lock at any given point in time. That thread is the owner of the lock.
- Upon the unlock, when more than one thread attempts to get the lock, the kernel will guarantee that exactly one thread will get the lock.
  - The winner thread sees the lock operation as a non-blocking call; it continues into the critical section.
  - The loser threads see the lock operation as a blocking call. They now wait or block upon the unlock operation.
  - The winner thread, upon atomically completing the critical section, performs the unlock operation.
  - One of the loser thread will now get the lock and the whole sequence repreats.
- **Mutual Exclusion** (`mutex`): Locks, such as mutexes, provide mutual exclusion by allowing only one thread to access the protected code at any given moment.
- **Deadlock:**
  - A situation where two or more threads are waiting indefinitely for locks held by each other. 
  - Proper design and lock ordering are crucial to prevent deadlocks.
- **Spinlocks vs. Mutexes:**
  - Spinlocks cause a thread to repeatedly check (or "spin") until the lock becomes available. 
  - Mutexes typically put the waiting thread to sleep, which can be more efficient when locks are held for longer durations.